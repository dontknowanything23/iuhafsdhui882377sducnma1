
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>calculate_pmv: predictive mean vote for room temperature comfort</title><meta name="generator" content="MATLAB 9.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2025-03-20"><meta name="DC.source" content="calculate_pmv.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>calculate_pmv: predictive mean vote for room temperature comfort</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li><li><a href="#2">Function Call</a></li><li><a href="#3">Inputs</a></li><li><a href="#4">Outputs</a></li><li><a href="#5">References and Literature</a></li><li><a href="#6">Calculations</a></li><li><a href="#8">internal functions</a></li><li><a href="#9">Copyright and Versions</a></li></ul></div><h2 id="1">Description</h2><pre>calculation of pmv - equation (1) in DIN EN ISO 7730:2005
PMV (Predicted Mean Vote) is the average evaluation of the climate of a
larger number of people. Individual evaluation may differ fromt the
average.
The result of the PMV is in 7 categories :
     +3 : hot
     +2 : warm
     +1 : slightly warm
      0 : neutral
     -1 : slightly cool
     -2 : cool
     -3 : cold</pre><h2 id="2">Function Call</h2><pre>pmv = calculate_pmv(meta, work, i_cl, v_air, p_h2o, t_air, t_rad)</pre><h2 id="3">Inputs</h2><pre>meta:         metabolic rate [W/m&sup2;]; 1 met = 58.2 W/m&sup2; */
work:         effective mechanical power [W/m&sup2;] */
i_cl:         clothing isolation [m&sup2;*K/W]; 1 clo = 0.155 m&sup2;*K/W */
t_air         air temperature [&deg;C] */
t_rad         mean radiation temperature [&deg;C] */
v_air         relative air velocity [m/s] */
p_h2o         partial pressure of water [Pa] */</pre><h2 id="4">Outputs</h2><pre>pmv - predicitve mean vote
      -3 = too cold
       0 = perfect comfort level
      +3 = too hot</pre><h2 id="5">References and Literature</h2><pre>DIN EN ISO 7730:2005
See also calculate_ppd and Carnot block PMV_PPD</pre><h2 id="6">Calculations</h2><p>original function in comfortsfcn.c: static double calculate_pmv(double m, double w, double f_cl, double h_c, double p_a, double t_a, double t_r, double t_cl)</p><h2 id="8">internal functions</h2><h2 id="9">Copyright and Versions</h2><pre>This file is part of the CARNOT Blockset.
Copyright (c) 1998-2024, Solar-Institute Juelich of the FH Aachen.
Additional Copyright for this file see list auf authors.
All rights reserved.
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:
1. Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
  notice, this list of conditions and the following disclaimer in the
  documentation and/or other materials provided with the distribution.
3. Neither the name of the copyright holder nor the names of its
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
THE POSSIBILITY OF SUCH DAMAGE.</pre><pre>************************************************************************
VERSIONS
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
author list:     hf -&gt; Bernd Hafner
                 aw -&gt; Arnold Wohlfeil
version: CarnotVersion.MajorVersionOfFunction.SubversionOfFunction
Version  Author  Changes                                     Date
6.1.0    hf      created form s-function comfortsfcn.c of aw 18oct2016
8.2.0    hf      added comments                              07jan2023
                 integrated sub-functions : clothing_area_factor
                 clothing_surface_temperature, heat_transfer_clothing
                 These were separate functions before, but they are
                 only usefull in the context of pmv caclulation.
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2022b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% calculate_pmv: predictive mean vote for room temperature comfort
%% Description
%  calculation of pmv - equation (1) in DIN EN ISO 7730:2005
%  PMV (Predicted Mean Vote) is the average evaluation of the climate of a 
%  larger number of people. Individual evaluation may differ fromt the 
%  average. 
%  The result of the PMV is in 7 categories :
%       +3 : hot
%       +2 : warm
%       +1 : slightly warm
%        0 : neutral
%       -1 : slightly cool
%       -2 : cool
%       -3 : cold
%% Function Call
%  pmv = calculate_pmv(meta, work, i_cl, v_air, p_h2o, t_air, t_rad)
%% Inputs
%  meta:         metabolic rate [W/m²]; 1 met = 58.2 W/m² */
%  work:         effective mechanical power [W/m²] */
%  i_cl:         clothing isolation [m²*K/W]; 1 clo = 0.155 m²*K/W */
%  t_air         air temperature [°C] */
%  t_rad         mean radiation temperature [°C] */
%  v_air         relative air velocity [m/s] */
%  p_h2o         partial pressure of water [Pa] */
%% Outputs
%  pmv - predicitve mean vote
%        -3 = too cold
%         0 = perfect comfort level
%        +3 = too hot
%% References and Literature
%  DIN EN ISO 7730:2005
%  See also calculate_ppd and Carnot block PMV_PPD

function pmv = calculate_pmv(meta, work, i_cl, v_air, p_h2o, t_air, t_rad)
%% Calculations
% original function in comfortsfcn.c:
% static double calculate_pmv(double m, double w, double f_cl, double h_c, double p_a, double t_a, double t_r, double t_cl)
la = length(t_air);
lr = length(t_rad);
if lr == 1
    N = la;
    t_rad = t_rad*ones(la,1);
elseif la == 1
    N = lr;
    t_air = t_air*ones(lr,1);
elseif la == lr
    N = la;
else
    error('calculate_pmv:InputLength','t_air and t_rad must be scalar or of same length)')
end
pmv = zeros(N,1);  % initialize variable
for n = 1:N
    % calculate the clothing surface temperature t_cl
    % t_cl = calculate_t_cl(meta, work, i_cl, t_air(n), t_rad(n), v_air);
    t_cl = fminsearch(@(t_cl) ...
        clothing_surface_temperature(meta, work, i_cl, v_air, t_air(n), t_rad(n), t_cl), ...
        (t_air(n) + t_rad(n))/2);
    f_cl = clothing_area_factor(i_cl); 
    h_c  = heat_transfer_clothing(v_air, t_cl, t_air(n));
    % calculate pmv 
    aux1 = (meta-work)-3.05e-3*(5733.0-6.99*(meta-work)-p_h2o(n))-0.42*((meta-work)-58.15);
    aux2 = -1.7e-5*meta*(5867.0-p_h2o(n))-0.0014*meta*(34.0-t_air(n));
    aux3 = -3.96e-8*f_cl*((t_cl+273.0).^4 - (t_rad(n)+273.0).^4) - f_cl*h_c*(t_cl-t_air(n));
    aux4 = 0.303*exp(-0.036*meta) + 0.028;
    pmv(n) = aux4 * (aux1 + aux2 + aux3);
end
end

%% internal functions
function h_c = heat_transfer_clothing(v_ar, t_cl, t_a)
%  calculation of the heat transfer coefficient - equation (3) of DIN EN ISO 7730:2005 */
h_c_1 = 2.38*sqrt(sqrt(abs(t_cl-t_a)));
h_c_2 = 12.1*sqrt(v_ar);
	
if (h_c_1 > h_c_2)
	h_c = h_c_1;
else
	h_c = h_c_2;
end
end

function f_cl = clothing_area_factor(i_cl)
%  calculation of the clothing area factor - equation (4) of DIN EN ISO 7730:2005
%  original name: calculate_f_cl
if (i_cl<=0.078)
	f_cl = 1.00+1.290*i_cl;
else
	f_cl = 1.05+0.645*i_cl;
end
end % of function clothing_area_factor

function result = clothing_surface_temperature(m, w, i_cl, v_ar, t_a, t_r, t_cl)
%  target function for fminsearch
%  surface temperature of the clothing - equation (2) of DIN EN ISO 7730:2005
%  minus t_cl in order to get a value of zero
%  origonal name: calculate_t_cl_tf
f_cl = clothing_area_factor(i_cl);
h_c = heat_transfer_clothing(v_ar, t_cl, t_a);
aux1 = 3.96e-8 * f_cl * ((t_cl+273.0).^4 - (t_r+273.0).^4);
aux2 = f_cl * h_c * (t_cl-t_a);
% result = 35.7 - 0.028*(m-w) - i_cl*(aux1 + aux2) - t_cl;
% use square of original equation for fminsearch
result = (35.7 - 0.028*(m-w) - i_cl*(aux1 + aux2) - t_cl).^2;
end % of function clothing_surface_temperature

%% Copyright and Versions
%  This file is part of the CARNOT Blockset.
%  Copyright (c) 1998-2024, Solar-Institute Juelich of the FH Aachen.
%  Additional Copyright for this file see list auf authors.
%  All rights reserved.
%  Redistribution and use in source and binary forms, with or without 
%  modification, are permitted provided that the following conditions are 
%  met:
%  1. Redistributions of source code must retain the above copyright notice, 
%    this list of conditions and the following disclaimer.
%  2. Redistributions in binary form must reproduce the above copyright 
%    notice, this list of conditions and the following disclaimer in the 
%    documentation and/or other materials provided with the distribution.
%  3. Neither the name of the copyright holder nor the names of its 
%    contributors may be used to endorse or promote products derived from 
%    this software without specific prior written permission.
%  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
%  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
%  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
%  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
%  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
%  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
%  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
%  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
%  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
%  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF 
%  THE POSSIBILITY OF SUCH DAMAGE.
%
%  ************************************************************************
%  VERSIONS
%  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
%  author list:     hf -> Bernd Hafner
%                   aw -> Arnold Wohlfeil
%  version: CarnotVersion.MajorVersionOfFunction.SubversionOfFunction
%  Version  Author  Changes                                     Date
%  6.1.0    hf      created form s-function comfortsfcn.c of aw 18oct2016
%  8.2.0    hf      added comments                              07jan2023
%                   integrated sub-functions : clothing_area_factor
%                   clothing_surface_temperature, heat_transfer_clothing
%                   These were separate functions before, but they are
%                   only usefull in the context of pmv caclulation.
% * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
##### SOURCE END #####
--></body></html>